<!DOCTYPE html><html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Расширенный многоуровневый ИИ на JavaScript</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f0f4f9; }
    input, button { padding: 8px; }
    .chat { margin-top: 20px; background-color: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); height: 400px; overflow-y: auto; }
    .message { margin-bottom: 10px; padding: 5px; border-radius: 5px; }
    .user { background-color: #dcf8c6; align-self: flex-end; }
    .bot { background-color: #ececec; align-self: flex-start; }
    .chat-container { display: flex; flex-direction: column; }
    .clear-btn { margin-left: 10px; }
  </style>
</head>
<body>
  <h2>Расширенный многоуровневый чат-бот (ИИ)</h2>
  <input type="text" id="userInput" placeholder="Задай вопрос" size="50">
  <button onclick="ask()">Отправить</button>
  <button class="clear-btn" onclick="clearChat()">Очистить чат</button>
  <div class="chat" id="chat"></div>  <script>
    let knowledgeBase = JSON.parse(localStorage.getItem('knowledgeBase')) || [
      {question: "привет", answer: "Привет! Чем могу помочь?"},
      {question: "как дела", answer: "Всё прекрасно! А как у тебя?"},
      {question: "кто ты", answer: "Я многоуровневый чат-бот на JavaScript, сохраняющий данные."},
      {question: "что ты умеешь", answer: "Я отвечаю на вопросы, сохраняю новые знания и понимаю контекст."},
      {question: "какой сегодня день", answer: () => `Сегодня: ${new Date().toLocaleDateString()}`},
      {question: "сколько времени", answer: () => `Текущее время: ${new Date().toLocaleTimeString()}`}
    ];

    function similarity(s1, s2) {
      const words1 = s1.split(/\s+/);
      const words2 = s2.split(/\s+/);
      const intersection = words1.filter(word => words2.includes(word));
      return intersection.length / Math.max(words1.length, words2.length);
    }

    function findBestMatch(query) {
      let bestMatch = null;
      let bestScore = 0;

      knowledgeBase.forEach(entry => {
        const score = similarity(query, entry.question);
        if (score > bestScore) {
          bestScore = score;
          bestMatch = entry;
        }
      });

      return bestScore > 0.3 ? bestMatch : null;
    }

    function generateContextualAnswer(query) {
      if (query.includes("помощь")) {
        return "Расскажи подробнее, в чём именно нужна помощь.";
      }
      if (query.includes("спасибо")) {
        return "Всегда рад помочь! Если ещё что-то понадобится, спрашивай.";
      }
      if (query.includes("забыть")) {
        knowledgeBase = [];
        saveKnowledgeBase();
        return "Я очистил память, теперь могу учиться заново.";
      }
      return null;
    }

    function saveKnowledgeBase() {
      localStorage.setItem('knowledgeBase', JSON.stringify(knowledgeBase));
    }

    function learnNewInformation(question, answer) {
      knowledgeBase.push({ question, answer });
      saveKnowledgeBase();
    }

    function clearChat() {
      document.getElementById("chat").innerHTML = "";
    }

    function ask() {
      const userText = document.getElementById("userInput").value.toLowerCase();
      const chat = document.getElementById("chat");

      const userMsg = document.createElement('div');
      userMsg.className = 'message user';
      userMsg.textContent = `Ты: ${userText}`;
      chat.appendChild(userMsg);

      let botAnswer = generateContextualAnswer(userText);
      const match = findBestMatch(userText);

      if (!botAnswer) {
        if (match) {
          botAnswer = typeof match.answer === 'function' ? match.answer() : match.answer;
        } else {
          botAnswer = "Я этого не знаю. Можешь научить меня? Введи ответ в формате 'Вопрос - Ответ'.";
        }
      }

      if (userText.includes(' - ')) {
        const parts = userText.split(' - ');
        learnNewInformation(parts[0].trim(), parts[1].trim());
        botAnswer = "Спасибо, я запомнил новую информацию!";
      }

      const botMsg = document.createElement('div');
      botMsg.className = 'message bot';
      botMsg.textContent = `ИИ: ${botAnswer}`;
      chat.appendChild(botMsg);

      chat.scrollTop = chat.scrollHeight;
      document.getElementById("userInput").value = "";
    }
  </script></body>
</html>
