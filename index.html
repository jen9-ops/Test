<!DOCTYPE html><html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ HF Inference</title>
  <style>
    body { font-family: Arial, sans-serif; background:#fafafa; padding:20px; }
    .box { max-width:600px; margin:auto; background:#fff; padding:20px;
           border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .box label { display:block; margin:12px 0 4px; }
    .box input[type="text"], .box textarea, .box select, .box button { width:100%; padding:8px; margin-bottom:8px; box-sizing:border-box; }
    #editor { height: 200px; border:1px solid #ddd; border-radius:4px; margin-top:10px; }
    .controls { display: flex; gap:10px; margin-top:10px; }
    .controls > * { flex:1; }
    .hidden { display: none; }
  </style>
  <!-- Ace Editor CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.11.2/ace.js" integrity="sha512-+GiXKP3jjxmclXKt5ydEmx64nkNykyBVy884hcXChzraJEjz/UNj4KfULtti6VyIwKHUr+T2D4XUl5SH2+NMog==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="box">
    <h2>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä PS1/Batch —Å–∫—Ä–∏–ø—Ç–æ–≤</h2>
    <label for="instruction">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–Ω–∞ —Ä—É—Å—Å–∫–æ–º):</label>
    <textarea id="instruction" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≤—ã–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä —á–µ—Ä–µ–∑ 20 –º–∏–Ω—É—Ç"></textarea><label for="lang">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Å–∫—Ä–∏–ø—Ç–∞:</label>
<select id="lang">
  <option value="ps1">PowerShell (.ps1)</option>
  <option value="bat">Batch (.bat)</option>
</select>

<label for="hfToken">Hugging Face API Token:</label>
<input id="hfToken" type="text" placeholder="xxxxxxxx-xxxx..." />

<div class="controls">
  <button id="gen">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
  <a id="download" class="hidden" style="text-align:center; padding:8px; background:#0078d4; color:#fff; text-decoration:none; border-radius:4px;">–°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç</a>
</div>

<div id="editor"># –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å‚Ä¶</div>

  </div>  <script>
    const editor = ace.edit("editor");
    editor.setTheme("ace/theme/chrome");
    editor.session.setMode("ace/mode/powershell");
    editor.setOptions({ fontSize: "14px", wrap: true, readOnly: true });

    const instrEl = document.getElementById('instruction');
    const langEl  = document.getElementById('lang');
    const tokenEl = document.getElementById('hfToken');
    const genBtn  = document.getElementById('gen');
    const dlLink  = document.getElementById('download');

    async function genScriptFetch(prompt, lang, token) {
      const modelId = 'google/flan-t5-base';
      const url = `https://api-inference.huggingface.co/models/${modelId}`;
      const body = {
        inputs: `# ${lang.toUpperCase()} script to: ${prompt}`,
        parameters: { max_new_tokens: 64, temperature: 0.2 }
      };
      const res = await fetch(url, {
        method: 'POST',
        headers: {
          Authorization: `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(`Error ${res.status}: ${text}`);
      }
      const data = await res.json();
      return data[0].generated_text.trim();
    }

    genBtn.onclick = async () => {
      const instr = instrEl.value.trim();
      const lang  = langEl.value;
      const token = tokenEl.value.trim();
      if (!instr) { alert('–í–≤–µ–¥–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é'); return; }
      if (!token) { alert('–í–≤–µ–¥–∏—Ç–µ HF —Ç–æ–∫–µ–Ω'); return; }

      genBtn.disabled = true;
      genBtn.textContent = '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è‚Ä¶';
      dlLink.classList.add('hidden');

      try {
        const script = await genScriptFetch(instr, lang, token);
        editor.session.setMode(lang === 'ps1' ? 'ace/mode/powershell' : 'ace/mode/batchfile');
        editor.setValue(script, -1);

        const blob = new Blob([script], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const ext = lang === 'ps1' ? 'ps1' : 'bat';
        dlLink.href = url;
        dlLink.download = `script.${ext}`;
        dlLink.textContent = `üì• –°–∫–∞—á–∞—Ç—å script.${ext}`;
        dlLink.classList.remove('hidden');
      } catch (e) {
        alert('–û—à–∏–±–∫–∞: ' + e.message);
      } finally {
        genBtn.disabled = false;
        genBtn.textContent = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å';
      }
    };
  </script></body>
</html>
